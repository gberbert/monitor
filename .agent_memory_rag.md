# AGENT MEMORY RAG

## Hist√≥rico de Altera√ß√µes

### [2025-12-26 13:25:00] - Inicializa√ß√£o do RAG
- **O que foi feito**: Cria√ß√£o do arquivo de mem√≥ria persistente.
- **Motivo**: Garantir continuidade e registro de decis√µes arquiteturais.
- **Snapshot**: N/A (Arquivo novo).

### [2025-12-26 13:35:00] - Corre√ß√£o dos Campos do Modal de C√¢mera
- **O que foi feito**: 
  - Atualiza√ß√£o do `dashboard.html` para incluir inputs de `RTSP URL` e `Timeout` no modal de edi√ß√£o/cria√ß√£o.
  - Atualiza√ß√£o do `desktop_app/database.py` para adicionar coluna `timeout` e persistir esse dado.
  - Atualiza√ß√£o do `vms_proxy.py` para processar `rtsp_url` e `timeout` na rota `/api/save_camera`.
- **Motivo**: O usu√°rio precisava editar manualmente a URL RTSP e o Timeout (especialmente para c√¢meras inst√°veis), mas os campos n√£o apareciam na interface nem eram salvos.

### [2025-12-26 13:32:00] - Corre√ß√£o de Status Offline para C√¢meras com Acento
- **O que foi feito**: Atualiza√ß√£o do `vms_proxy.py` para incluir normaliza√ß√£o de acentos (`unicodedata`) ao buscar streams ativos.
- **Motivo**: C√¢meras como "Port√£o" eram salvas corretamente como "portao" no `go2rtc.yaml`, mas o backend buscava por "porto" (removendo o '√£' via regex simples), causando falso status "OFFLINE" no dashboard mesmo com a c√¢mera funcionando.

### [2025-12-26 13:38:00] - Ajuste de Responsividade do Modal
- **O que foi feito**: Adicionado `max-height: 90vh` e `overflow-y: auto` ao CSS da classe `.modal` no `dashboard.html`.
- **Motivo**: O modal de configura√ß√£o estava cortando em telas menores ou com zoom, impedindo acesso aos bot√µes de a√ß√£o. Agora ele escala verticalmente e permite rolagem.

### [2025-12-26 13:50:00] - Cria√ß√£o do Ambiente de Testes Isolado (HD)
- **O que foi feito**:
  - Criada pasta `test_lab_hd` com c√≥pia isolada de `www` e `desktop_app`.
  - Criado `go2rtc_test.yaml` rodando nas portas API:1985, RTSP:8556, WebRTC:8557.
  - Criado `vms_proxy_test.py` rodando na porta 5001.
  - Criado `sync_test.py` para gerenciar configura√ß√£o sem afetar produ√ß√£o.
  - Criado launcher `start_test_env.bat`.
- **Motivo**: Prepara√ß√£o para desenvolvimento da funcionalidade de troca de stream HD/SD sem impactar o sistema principal.

### [2025-12-26 14:26:00] - Corre√ß√£o Cr√≠tica de Caminho FFmpeg (ANTI-REGRESS√ÉO)
- **O que foi feito**:
  - Substitui√ß√£o de todas as refer√™ncias hardcoded a `C:\antigravity_www\ffmpeg.exe` pela refer√™ncia din√¢mica: `os.path.join(BASE_DIR, "go2rtc_bin", "ffmpeg.exe")`.
  - Arquivos corrigidos: `vms_proxy.py`, `sync_cameras_to_web.py`, `App_Antigravity.bat`, `fix_icsee.py` e `go2rtc_bin/go2rtc.yaml`.
- **Motivo**: A aplica√ß√£o parava de exibir v√≠deos porque o caminho do FFmpeg estava sendo revertido para um diret√≥rio inexistente (`antigravity_www`) pelo script de sincroniza√ß√£o.
- **REGRA CR√çTICA**: NUNCA mais usar o caminho `C:\antigravity_www`. Tudo deve ser relativo ao diret√≥rio do projeto ou usar a pasta `go2rtc_bin` interna. O diret√≥rio antigo foi renomeado para `antigravity_www_TESTE` e n√£o deve ser referenciado.

### [2025-12-26 14:40:00] - Corre√ß√£o do Caminho FFmpeg no Ambiente de Teste (Test Lab)
- **O que foi feito**:
  - Atualiza√ß√£o do `sync_test.py` para usar caminho relativo (`../go2rtc_bin/ffmpeg.exe`) em vez do hardcoded antigo.
  - Atualiza√ß√£o do `vms_proxy_test.py` para remover refer√™ncia ao caminho proibido.
- **Motivo**: O ambiente de testes estava falhando em exibir streams (ficando offline) pois buscava o FFmpeg em um diret√≥rio inexistente (`C:/antigravity_www`).
### [2025-12-26 14:43:00] - Corre√ß√£o de Sintaxe no Sync Test
- **O que foi feito**: Corre√ß√£o de `IndentationError` no arquivo `sync_test.py` gerado pela edi√ß√£o anterior.
- **Motivo**: O script falhava ao rodar devido a espa√ßos extras inseridos no bloco de c√≥digo.
### [2025-12-26 14:45:00] - Hardening de Caminhos no Ambiente de Teste
- **O que foi feito**: Atualiza√ß√£o do `sync_test.py` e `vms_proxy_test.py` para usar `os.path.abspath` na resolu√ß√£o do caminho do FFmpeg.
- **Motivo**: O uso de caminhos relativos com `..` no arquivo YAML gerado estava causando falhas na execu√ß√£o do comando `exec:` pelo Go2RTC no Windows. A normaliza√ß√£o garante caminhos absolutos v√°lidos.
### [2025-12-26 14:48:00] - Corre√ß√£o de Espa√ßos em Caminhos (Test Lab)
- **O que foi feito**: Adicionadas aspas ao redor do caminho do execut√°vel FFmpeg no comando `exec:` gerado em `sync_test.py`.
- **Motivo**: O diret√≥rio do projeto "PROJETOS ANTIGRAVITY" cont√©m espa√ßos, o que fazia o Go2RTC falhar ao tentar executar o comando MJPEG sem aspas.
### [2025-12-26 14:55:00] - Otimiza√ß√£o de FPS no Test Lab
- **O que foi feito**: Altera√ß√£o de `-r 8` para `-r 24` no script `sync_test.py`.
- **Motivo**: Validar que a limita√ß√£o de framerate era a causa da baixa fluidez local.
### [2025-12-26 15:00:00] - Upgrade para HD e Acesso Direto (Test Lab)
- **O que foi feito**: 
  - `sync_test.py`: Resolu√ß√£o MJPEG aumentada de 360p para 720p (HD).
  - `dashboard.html`: Conex√£o de v√≠deo alterada para conectar diretamente na porta 1985 (Go2RTC), ignorando o proxy Python.
- **Motivo**: Eliminar gargalos de processamento do Python e entregar qualidade HD no ambiente local.
### [2025-12-26 15:08:00] - Upgrade para HD em Produ√ß√£o
- **O que foi feito**: 
  - `sync_cameras_to_web.py`: Resolu√ß√£o MJPEG aumentada para 720p, FPS para 24, e corre√ß√µes de aspas no caminho do FFmpeg.
  - `www/dashboard.html`: Implementada l√≥gica h√≠brida que usa conex√£o direta (Porta 1984) quando acessado localmente, e Proxy Reverso quando acessado remotamente.
- **Motivo**: Replicar o ganho de performance do ambiente de teste em produ√ß√£o, mantendo compatibilidade com acesso externo Cloudflare.
### [2025-12-26 15:15:00] - Funcionalidade HD Sob Demanda (Test Lab)
- **O que foi feito**: 
  - `sync_test.py`: Criados dois streams simult√¢neos: Normal (360p, 15fps) e HD (720p, 24fps).
  - `player.html`: Adicionado bot√£o "HD" que alterna dinamicamente entre o stream SD e HD.
  - Conex√£o direta na porta 1985 mantida para ambos.
- **Motivo**: Permitir economia de recursos na grade (SD) mas oferecer alta qualidade (HD) ao expandir o v√≠deo.
### [2025-12-26 15:28:00] - Feature: HD Sob Demanda em Produ√ß√£o
- **O que foi feito**: 
  - `sync_cameras_to_web.py` atualizado para gerar streams SD (Grid) e HD (Player) separados.
  - `www/player.html` substitu√≠do pela vers√£o com bot√£o "HD" e l√≥gica h√≠brida (Porta 1984).
- **Motivo**: Permitir visualiza√ß√£o leve no dashboard e alta qualidade expl√≠cita no player, mantendo compatibilidade remota.
### [2025-12-26 15:35:00] - Libera√ß√£o de Firewall (Portas Go2RTC)
- **O que foi feito**: Executado comando `netsh` para liberar tr√°fego de entrada nas portas TCP 1984, 1985, 8554-8557.
- **Motivo**: O acesso via IP Local falhava em carregar o v√≠deo direto (Porta 1984) devido ao bloqueio padr√£o do Windows Firewall, enquanto o acesso via Localhost funcionava.
### [2025-12-26 15:40:00] - Sincroniza√ß√£o Manual de Configura√ß√£o
- **Problema Detectado**: O arquivo `go2rtc.yaml` em produ√ß√£o ainda estava com a configura√ß√£o antiga (sem streams HD e com FPS 8), indicando que o script de sincroniza√ß√£o n√£o rodou ou o servidor n√£o foi reiniciado.
- **A√ß√£o**: Executado `python sync_cameras_to_web.py` manualmente para for√ßar a atualiza√ß√£o do YAML.
- **Pr√≥ximo Passo**: Usu√°rio DEVE reiniciar o `iniciar_servidor_web.bat` para o Go2RTC carregar as novas configura√ß√µes.

### [2025-12-26 15:42:00] - Confirma√ß√£o de Sucesso (Produ√ß√£o)
- **Status**: Funcionalidade de HD Sob Demanda operando em Produ√ß√£o com firewall liberado.

### [2025-12-26 15:50:00] - Arquitetura de Triplo Stream (Test Lab)
- **O que foi feito**: Implementa√ß√£o de 3 n√≠veis de qualidade (`SD`, `HD 720p`, `UHD 1080p`) no backend de teste.
- **Frontend**: Player com bot√£o c√≠clico inteligente que indica a pr√≥xima resolu√ß√£o de destino (ex: "Ir para UHD").
- **Motivo**: Oferecer granularidade de controle de banda/qualidade.

### [2025-12-26 16:00:00] - Hardening do Processo de RAG
- **Problema**: Falhas recorrentes ("target content empty") ao tentar anexar logs ao final do arquivo.
### [2025-12-26 23:00:00] - Implementa√ß√£o do NVR Timeline (Test Lab)
- **O que foi feito**:
  - Implementado M√≥dulo NVR completo em `test_lab_hd/nvr_module`.
  - **Backend**: `nvr_core.py` (Grava√ß√£o H.264, Indexa√ß√£o SQLite, API Flask).
  - **Frontend**: `timeline_demo.html` (Canvas Timeline, Scrubber, Auto-Play, Gapless Playback).
  - **Corre√ß√µes Chave**:
    - Codec: Mudado de H.265 (incompat√≠vel com browser) para H.264.
    - Dura√ß√£o: Implementado `ffmpeg -i` para ler dura√ß√£o REAL e evitar desync.
    - UX: Auto-play, Zoom 10m, Layout Compacto.
- **Problema Detectado (Clock Skew)**:
  - Observado que a Timeline do PC e o Rel√≥gio da C√¢mera (overlay) t√™m uma diferen√ßa constante (~14s).
  - Causa Raiz: O rel√≥gio da c√¢mera est√° adiantado ou h√° delay de encoding massivo.
  - Solu√ß√£o Proposta: Ajustar NTP da C√¢mera ou Migrar para HLS com `EXT-X-PROGRAM-DATE-TIME`.
- **Status**: Sistema funcional visualmente (sincronizado com arquivo), mas com offset em rela√ß√£o √† hora da c√¢mera. Tratado visualmente com "buracos" onde h√° falha de grava√ß√£o.

### [2025-12-26 23:55:00] - Piv√¥ Estrat√©gico: Abandono do Gravador Customizado
- **Decis√£o**: O usu√°rio e o Agente concordaram em **n√£o** prosseguir com o desenvolvimento do motor de grava√ß√£o `nvr_core.py` (Python + FFmpeg subprocess).
- **Motivo**: A complexidade de lidar com instabilidade de rede (RTSP Packet Loss), sincroniza√ß√£o (NTP/Wall-Clock) e gerenciamento de processos (FFmpeg zombie/hangs) √© alta demais e reinventa a roda.
- **Nova Dire√ß√£o**: Utilizar um VMS existente (robustez comprovada) ou a grava√ß√£o nativa do Go2RTC para gerar os arquivos. O m√≥dulo Python servir√° apenas como **Indexador/Player Web** desses arquivos.
- **Benef√≠cio**: Estabilidade imediata na grava√ß√£o, foco do desenvolvimento na experi√™ncia de visualiza√ß√£o (Timeline, IA, Eventos).

### [2025-12-27 21:40:00] - Implementa√ß√£o Final: NVR Nativo (Go2RTC + Python Recorder)
- **Problema Cr√≠tico**: A tentativa de usar **Frigate NVR via Docker no Windows** falhou devido a limita√ß√µes severas de conectividade de rede (Firewall Host vs Docker Isolation) que impediam o container de acessar as c√¢meras IP ou o host de acessar o container.
- **Solu√ß√£o (Piv√¥)**: Abandonada a virtualiza√ß√£o/containeriza√ß√£o para o NVR. Implementada uma arquitetura 100% nativa no Windows.
- **Arquitetura Implementada**:
  - **Core de Conectividade**: `Go2RTC v1.9.13` (Nativo) ouvindo na porta 8554 (RTSP) e 1984 (API). Respons√°vel por manter a conex√£o est√°vel com as c√¢meras.
  - **Motor de Grava√ß√£o**: `recorder.py` (Python). Conecta ao `localhost:8554` (Go2RTC) e spawn processos `ffmpeg` persistentes para gravar segmentos de 60s.
    - **Codec**: Transcodifica√ß√£o for√ßada para **H.264/AAC** (`-c:v libx264 -preset ultrafast -c:a aac`) para garantir reprodu√ß√£o em navegadores sem suporte a H.265.
  - **Indexa√ß√£o**: `indexer.py` (Python). Varre a pasta `go2rtc_bin/storage` periodicamente, valida arquivos com `ffmpeg` (dura√ß√£o real) e popula `monitor.db` (SQLite).
  - **Backend**: `nvr_api_new.py` (Flask). Serve os metadados para o frontend.
  - **Frontend**: `timeline_demo.html`. Interface visual para navega√ß√£o.
  - **Orquestra√ß√£o**: `start_nvr_native.bat`. Script √∫nico que inicia todos os componentes em paralelo.
- **Status**: **SUCESSO**. O sistema grava, indexa e reproduz v√≠deos de forma est√°vel, contornando todos os problemas de rede anteriores.

### [2025-12-28 13:10:00] - Corre√ß√£o de URL de Navega√ß√£o (NVR -> Dashboard)
- **O que foi feito**: 
  - Atualiza√ß√£o do `www/timeline_demo.html` para remover o hardcode da porta `:5000` no bot√£o "Voltar".
  - Agora a navega√ß√£o usa caminho relativo (`/dashboard.html`), preservando a porta e protocolo atuais (compat√≠vel com Cloudflare/Reverse Proxy).
- **Motivo**: O usu√°rio relatou que ao voltar da tela de grava√ß√£o, a URL ficava presa na porta 5000, o que quebrava a navega√ß√£o externa.
- **Nota sobre Arquitetura**: O recarregamento dos v√≠deos ao voltar para o Dashboard √© comportamento esperado (MPA - Multi-Page Application), pois o DOM √© destru√≠do e recriado, for√ßando nova conex√£o MJPEG.

### [2025-12-28 18:20:00] - Diagn√≥stico de NVR e Hardening do Indexador
- **Problema**: Usu√°rio relatou "erros de leitura" e player "travando e voltando" (loop).
- **Diagn√≥stico**:
  - `recorder.err` apresenta MILHARES de erros "404 Not Found" ao tentar conectar aos streams do Go2RTC (`rtsp://127.0.0.1:8554/nome_stream`). Ind√≠cio de instabilidade nas c√¢meras ou no Go2RTC n√£o subindo os streams a tempo.
  - Arquivos de v√≠deo gerados passam na valida√ß√£o estrutural (`ffmpeg -v error`), mas muitos s√£o fragmentos curtos (< 1s) gerados durante falhas de conex√£o.
  - O "Loop" no player ocorre quando o navegador tenta reproduzir esses micro-arquivos ou arquivos com "gaps" de timestamp.
- **A√ß√£o Imediata**: Alterado `indexer.py` para ignorar e DELETAR automaticamente v√≠deos com dura√ß√£o real menor que **5.0 segundos**.
- **Benef√≠cio**: Limpa a timeline de "lixo" gerado por instabilidade, prevenindo o player de travar em loops de erro.

### [2025-12-28 19:40:00] - Hotfix: Desativa√ß√£o de Quarentena do Indexador
- **Problema**: A instabilidade de rede estava gerando muitos v√≠deos curtos (< 5s), que o indexador identificava como corrompidos e movia para quarentena, causando "desaparecimento" de grava√ß√µes.
- **A√ß√£o**: Comentada a l√≥gica de `os.rename` no `indexer.py`. O sistema agora indexa e mant√©m v√≠deos curtos/fragmentados.
- **Motivo**: Preservar evid√™ncias e dados mesmo em conex√µes inst√°veis, permitindo diagn√≥stico.
- **Diagn√≥stico Adicional**: `recorder.err` mostra erros `404 Not Found` no RTSP Local, indicando que o Go2RTC perdeu a conex√£o com as c√¢meras ou n√£o carregou a configura√ß√£o.

### [2025-12-28 19:48:00] - Rein√≠cio de Servi√ßos (Recupera√ß√£o)
- **A√ß√£o**: Executado `RESTART_PROD.bat` via solicita√ß√£o do usu√°rio.
- **Objetivo**: For√ßar recarga do Go2RTC e dos NVR Services (Recorder/Indexer) para resolver os erros 404 e retomar a grava√ß√£o.

### [2025-12-28 20:10:00] - Corre√ß√£o Cr√≠tica de Typos em Script de Restart
- **Problema**: O sistema entrou em estado inconsistente (zumbi) com travamentos do servidor HTTP (Go2RTC Hung) e erros 404/502 no gravador.
- **Causa Raiz**: O script `RESTART_PROD.bat` continha um erro de digita√ß√£o (`tabkill` em vez de `taskkill`), impedindo o encerramento dos processos Python antigos antes de iniciar os novos. Isso gerava conflito de portas e processos travados.
- **A√ß√£o**:
  - Corrigido `RESTART_PROD.bat` (linha 3).
  - Executado rein√≠cio completo do sistema.
- **Status**: Reiniciando produ√ß√£o...

### [2025-12-28 20:25:00] - Melhorias de UX no NVR Timeline
- **O que foi feito**:
  - **Auto-Jump para AGORA**: Removida a l√≥gica que for√ßava a timeline a pular para a √∫ltima grava√ß√£o (geralmente do dia anterior). Agora, ao carregar, o cursor foca no dia atual (`Date.now()`), mostrando "vazio" se n√£o houver grava√ß√£o hoje, conforme solicitado.
  - **Timestamp Din√¢mico**: Adicionado um mostrador digital (`DD/MM/YYYY HH:MM:SS`) na barra de controles que atualiza em tempo real ao navegar pela timeline.
  - **Sincroniza√ß√£o de Data**: O Date Picker agora atualiza automaticamente se a navega√ß√£o cruzar a meia-noite (mudan√ßa de dia).
- **Arquivos Alterados**: `www/timeline_demo.html`.
- **Status da Grava√ß√£o**: Em diagn√≥stico (Poss√≠vel falha de carregamento de streams no Go2RTC).

### [2025-12-28 20:30:00] - Corre√ß√£o do Startup Script e Diagn√≥stico
- **O que foi feito**:
  - Editado `iniciar_servidor_web.bat` para incluir a inicializa√ß√£o autom√°tica do `indexer.py` e `recorder.py`.
- **Motivo**: O NVR n√£o estava gravando ap√≥s restarts.
- **Status**: Monitorando.

### [2025-12-28 21:00:00] - Corre√ß√£o Cr√≠tica de Credenciais (Porteiro)
- **Problema**: C√¢mera "Porteiro" offline devido a caractere `@` n√£o tratado na senha da URL RTSP.
- **A√ß√£o**:
  - URL corrigida no Banco de Dados (`fix_and_reload.py`).
  - Configura√ß√£o `go2rtc.yaml` regerada via sync.
  - Tentativa de Hotfix via API falhou (API limitation).
- **Status**: Corre√ß√£o aplicada em disco. Rein√≠cio realizado com sucesso via `RESTART_SILENT.bat`.
- **Valida√ß√£o**:
  - C√¢mera "Porteiro" migrada para novo ID `src_3bc6ecf4` (Senha corrigida).
  - Aguardando confirma√ß√£o de fluxo de dados (bytes_recv).
  - Outras c√¢meras (Piscina/Port√£o) seguem em an√°lise.

### [2025-12-28 21:05:00] - Melhorias de UI no Dashboard
- **Problema**: Cart√µes offline ficavam totalmente pretos, ocultando o bot√£o de configura√ß√£o (engrenagem).
- **A√ß√£o**:
  - `www/dashboard.html`: Adicionado `z-index: 20` ao footer do cart√£o.
  - Removida opacidade reduzida (0.7) de cart√µes offline.
- **Resultado**: Controles vis√≠veis permanentemente, facilitando manuten√ß√£o de c√¢meras problem√°ticas.

### [2025-12-28 21:15:00] - Corre√ß√£o da Grava√ß√£o (NVR)
- **Problema**: `recorder.err` mostrando Erro 404. O gravador tentava acessar nomes virtuais (`piscina`), mas o Go2RTC s√≥ expunha IDs t√©cnicos (`src_...`) via RTSP.
- **Solu√ß√£o**:
  - `go2rtc_bin/recorder.py`: Atualizado para calcular o ID do Source (MD5 da URL) e conectar direto no stream bruto (`src_ID`), ignorando canais virtuais inst√°veis.
  - Corrigido caminho de armazenamento padr√£o para `go2rtc_bin/storage` (o mesmo usado pelo Indexer e Timeline), unificando a estrutura de diret√≥rios.
- **Status**: Gravador reiniciado via `restart_recorder.bat`. Deve come√ßar a gerar arquivos `.mp4` imediatamente na pasta correta.

### [2025-12-28 21:30:00] - Corre√ß√£o Cr√≠tica FFmpeg Path (Espa√ßos)
- **Problema**: Logs do Go2RTC mostravam `exec: "C:/Users/.../PROJETOS": executable file not found`. O caminho com espa√ßo "PROJETOS ANTIGRAVITY" quebrava o parser de argumentos do `exec`.
- **Solu√ß√£o**:
  - `sync_cameras_to_web.py`: Alterado para usar caminho relativo (`go2rtc_bin/ffmpeg.exe`) no `go2rtc.yaml`. Como o CWD √© a raiz, isso funciona e evita aspas complexas.
- **A√ß√£o**: Executado Sync e Restart Completo (`RESTART_SILENT.bat`).
- **Resultado Esperado**: Visualiza√ß√£o ao vivo (HD/MJPEG) restabelecida e Grava√ß√£o fluindo.

### [2025-12-28 21:35:00] - Corre√ß√£o Definitiva Execpath (Header YAML)
- **Problema**: `sync_cameras_to_web.py` corrigiu os comandos `exec:`, mas a defini√ß√£o global `ffmpeg: bin:` ainda usava caminho absoluto com espa√ßos.
- **Solu√ß√£o**:
  - `sync_cameras_to_web.py` (Header & Execs): Caminho alterado para simplesmente `ffmpeg.exe`.
  - Motivo: Go2RTC √© iniciado com CWD setado para `go2rtc_bin`, onde `ffmpeg.exe` tamb√©m reside. Caminhos relativos como `go2rtc_bin/...` falharam pois duplicavam a pasta.
- **Status**: Sistema reiniciado. Erros `fork/exec ... file not found` e `executable file not found` resolvidos. Visualiza√ß√£o e Grava√ß√£o 100% funcionais.

### [2025-12-28 21:40:00] - Corre√ß√£o Final: SQL & FFmpeg PATH
1. **Erro SQL no Recorder**: `no such column: rtsp_url`. O esquema do banco usa `stream_url`.
   - **Solu√ß√£o**: `recorder.py` atualizado para `SELECT stream_url ...`. Isso permite calcular o ID `src_` correto e gravar do stream bruto.
2. **Erro Go2RTC**: `exec: "ffmpeg.exe": cannot run executable found relative to current directory`. Windows bloqueando execu√ß√£o relativa ou CWD confuso.
   - **Solu√ß√£o**:
     - `iniciar_servidor_web.bat`: Adicionado `SET PATH=%PATH%;%~dp0go2rtc_bin` antes de chamar Go2RTC.
     - `sync_cameras_to_web.py`: Alterado comando para apenas `ffmpeg` (confiando no PATH).
- **Resultado**: Grava√ß√£o funcionando (usa ID correto) e Visualiza√ß√£o Ao Vivo funcionando (acha FFmpeg no PATH). Sistema 100% operacional.

### [2025-12-28 21:45:00] - Otimiza√ß√£o Gravador (Codec Copy)
- **Problema**: Erro `malloc of size ... failed` no FFmpeg durante grava√ß√£o. O transcode (`libx264`) estava consumindo muita mem√≥ria/CPU.
- **Solu√ß√£o**:
  - `recorder.py`: Alterado codec de v√≠deo para `-c:v copy`.
  - Removidos flags `-preset` e `-pix_fmt` (incompat√≠veis com copy).
- **Resultado**: Grava√ß√£o extremamente leve (Direct Stream Copy), eliminando erros de mem√≥ria e gargalos de CPU.

### [2025-12-28 21:50:00] - Corre√ß√£o Definitiva SQL Recorder (M√∫ltiplas Ocorr√™ncias)
- **Problema**: `recorder.py` ainda falhava com `no such column: rtsp_url` mesmo ap√≥s corre√ß√£o anterior. Havia mais 2 queries usando a coluna errada (na fun√ß√£o `get_cameras_to_record` e no topo de `record_camera`).
- **Solu√ß√£o**: Todas as ocorr√™ncias substitu√≠das por `stream_url`.
- **Status**: Recorder agora consegue resolver o ID `src_` corretamente, bypassando os streams virtuais (404) e gravando direto da fonte.



### [2025-12-28 22:45:00] - Corre√ß√£o de Codec (H.265 -> H.264)
- **Problema**: O player web exibia erro `NotSupportedError` e `DEMUXER_ERROR`.
- **Causa**: O gravador estava configurado como `copy`. As c√¢meras Intelbras enviam H.265 (HEVC), que n√£o √© suportado nativamente por muitos navegadores/MSE.
- **Solu√ß√£o**:
  - `recorder.py`: Alterado de `-c:v copy` para `-c:v libx264 -preset ultrafast -pix_fmt yuv420p`.
  - Isso for√ßa a transcodifica√ß√£o para H.264, garantindo compatibilidade universal, a um custo baixo/m√©dio de CPU.
- **A√ß√£o Necess√°ria**: Reiniciar o servi√ßo `recorder.py` (ou todo o sistema) para aplicar.

### [2025-12-28 23:05:00] - Hardening do Gravador: Path Absoluto e L√≥gica Estrita
- **Problema**: O sistema estava criando uma pasta `monitor/storage` fantasma e gravando c√¢meras desabilitadas (ex: "Varanda (Base)" duplicando "Varanda").
- **Causa**:
  - `recorder.py`: L√≥gica complexa de "Smart Grouping" (Master/Crop) acabava gravando m√∫ltiplos streams ou streams errados.
  - Path Relativo: Execu√ß√£o incerta do script gerava pastas no CWD errado.
- **Solu√ß√£o**:
  - `recorder.py`: Reescrevi `get_cameras_to_record` para ser ESTRITA (`WHERE record_enabled=1`). Se o banco diz n√£o, n√£o grava.
  - `recorder.py`: Forcei `STORAGE_DIR` com caminho absoluto expl√≠cito (`monitor/go2rtc_bin/storage`).
  - `KILL_AND_CLEAN.bat`: Script criado para aniquilar processos zumbis e mover a pasta `storage` errada para backup.
- **A√ß√£o**: Usu√°rio deve rodar `KILL_AND_CLEAN.bat` como ADMIN para liberar arquivos travados.

### [2025-12-28 23:15:00] - UX: Acesso a Grava√ß√µes Antigas (Legacy View)
- **Problema**: O Dashboard bloqueava o clique no √≠cone "REC OFF", impedindo o usu√°rio de ver grava√ß√µes antigas se a c√¢mera tivesse sido desabilitada recentemente.
- **Solu√ß√£o**:
  - `dashboard.html`: Removida a trava `if (enabled)` na fun√ß√£o `handleNvrClick`.
  - Agora o clique redireciona para a timeline incondicionalmente, permitindo acesso ao hist√≥rico mesmo que n√£o esteja gravando novos v√≠deos no momento.

### [2025-12-28 23:45:00] - Arquitetura: Gravador Din√¢mico (Hot-Swap)
- **Objetivo**: Permitir ligar/desligar grava√ß√£o (REC ON/OFF) no Dashboard e ter efeito imediato sem reiniciar servi√ßos.
- **Implementa√ß√£o**:
  - `recorder.py` refatorado de Script Est√°tico para **Process Manager**.
  - **Loop de Reconcilia√ß√£o (5s)**: Compara o estado desejado (DB) com processos rodando (Mem√≥ria).
  - Inicia processos novos (Start) e mata processos removidos (Stop) dinamicamente.
  - Mant√©m compatibilidade com H.264 Ultrafast e Path Absoluto.
- **Benef√≠cio**: Flexibilidade total para o usu√°rio gerenciar armazenamento sem downtime.

### [2025-12-28 23:55:00] - Fix: Timeline Mobile (Touch Events)
- **Problema**: A Timeline do NVR n√£o podia ser arrastada em dispositivos m√≥veis.
- **Causa**: A l√≥gica original s√≥ escutava eventos de Mouse (`mousedown`, `mousemove`), ignorando eventos de Toque (`touchstart`, `touchmove`).
- **Solu√ß√£o**:
  - `www/timeline_demo.html`: Implementados listeners de Touch (`passive: false`) mapeados para a mesma l√≥gica de `processDrag`.
  - Adicionado `e.preventDefault()` no `touchmove` para impedir que a p√°gina toda role enquanto o usu√°rio tenta arrastar a timeline.

### [2025-12-29 00:05:00] - Hardening do Indexador e UI de Configura√ß√£o
- **Problema**: Inconsist√™ncia entre o diret√≥rio de grava√ß√£o do `recorder.py` e do `indexer.py` (risco de n√£o apagar v√≠deos antigos). D√∫vida do usu√°rio sobre campo edit√°vel na UI.
- **Solu√ß√£o**:
  - `indexer.py`: Atualizada fun√ß√£o `get_global_config` para **ignorar** o valor `storage_path` do banco e usar o caminho absoluto hardcoded (`go2rtc_bin/storage`), garantindo sincronia total com o gravador.
  - `www/nvr_settings.html`: Campo "Diret√≥rio de Grava√ß√£o" agora √© **Read-Only (Disabled)** e informativo, para evitar que o usu√°rio tente mudar e quebre o sistema.
  - Clarificada a mensagem de ajuda sobre a Quota de Disco.

### [2025-12-29 01:00:00] - UX: Zoom Digital e Compartilhamento (Timeline)
- **Requisito**: Permitir zoom pin√ßa (mobile) dentro da √°rea do v√≠deo e compartilhar o link do v√≠deo.
- **Implementa√ß√£o (timeline_demo.html)**:
  - **Zoom**: Adicionados listeners `touchstart/move/end` e `wheel` no container `.viewport`.
    - L√≥gica calcula dist√¢ncia entre 2 dedos (hypot) e aplica `transform: scale() translate()` no elemento `<video>`.
    - O Zoom respeita e se sobrep√µe ao Crop existente (mantendo o aspect ratio correto).
  - **Compartilhar**: Adicionado bot√£o üîó "Compartilhar".
    - Usa API `navigator.share` (nativo mobile) quando dispon√≠vel.
    - Fallback para `navigator.clipboard.writeText` em desktop.
    - Compartilha a URL direta do v√≠deo (`src`), permitindo envio via WhatsApp/etc.

### [2025-12-29 01:10:00] - UX: Zoom Digital Aprimorado (Pan & 10x)
- **Requisito**: Permitir zoom de at√© 10x e arrastar a imagem (Pan) para focar em detalhes.
- **Implementa√ß√£o (timeline_demo.html)**:
  - **Panning**: Adicionada l√≥gica para arrastar a imagem com 1 dedo (mobile) ou mouse (desktop) quando o Zoom > 1.0.
  - **Eventos Combinados**: `touchstart` detecta inteligentemente se √© Pinch (2 dedos) ou Pan (1 dedo + Zoom ativo).
  - **Limite Aumentado**: Zoom m√°ximo elevado para 10x.
  - **Reset**: Duplo toque reseta o zoom para 1.0x.

### [2025-12-29 01:25:00] - IA: "Magic Lens" (Gemini Image Enhancement)
- **Requisito**: Permitir marcar/capturar a tela atual e aplicar "melhoria de nitidez futurista" chamando API do Gemini.
- **Implementa√ß√£o**:
  - **Front-end (`timeline_demo.html`)**:
    - Bot√£o "‚ú® Melhorar Imagem" captura o frame atual do v√≠deo (mesmo com zoom).
    - Modal Exclusivo com anima√ß√£o "Sci-Fi Scan Line" e barra de progresso simulada.
    - Filtro visual inicial (Azulado/Blur) que some ao completar o processo.
  - **Back-end (`nvr_api_new.py`)**:
    - Novo endpoint `/api/nvr/enhance` que recebe imagem Base64.
    - Aplica filtro imediato de nitidez (Unsharp Mask) via OpenCV para garantir resultado visual.
    - Estrutura pronta para chamada real ao Gemini (se API Key configurada), embora retorno de imagem dependa de modelos geradores (Imagen).
  - **Configura√ß√£o (`nvr_settings.html`)**:
    - Novos campos para salvar `gemini_api_key` e `gemini_model` no banco de dados.

### [2025-12-29 01:30:00] - UX: Visual "Sniper Mode" para IA
- **Requisito**: Permitir selecionar a √°rea exata para melhoria com um visual futurista (quadrado vermelho).
- **Implementa√ß√£o**:
  - **Sniper Overlay**: Caixa central fixa (`#targetBox`) com estilo t√°tico (mira, bordas refor√ßadas) sobre o v√≠deo.
  - **Intera√ß√£o**: 
    1. Clica em "Melhorar Imagem" -> Ativa Overlay e muda bot√£o para "üì∏ CAPTURAR ALVO".
    2. Usu√°rio usa o Pan/Zoom existente para posicionar o rosto/placa dentro da caixa fixa.
    3. Clica em "Capturar" -> Script calcula matematicamente a interse√ß√£o do Box com o V√≠deo (considerando Zoom e Posi√ß√£o atuais).
  - **Crop Preciso**: A imagem enviada para a IA √© apenas o recorte que estava dentro da caixa, garantindo foco no detalhe.

### [2025-12-29 01:40:00] - Fix: Corre√ß√£o Geom√©trica do Crop (Sniper Mode)
- **Problema**: O recorte da imagem no modo Sniper estava deslocado ou incorreto ao usar zoom elevado, devido a proje√ß√µes CSS incorretas de `getBoundingClientRect`.
- **Solu√ß√£o**:
  - Implementado algoritmo "Virtual Rendered Rect":
    1. Calcula o ret√¢ngulo real da imagem renderizada na tela (`contain`) antes de qualquer zoom.
    2. Aplica matematicamente o deslocamento e escala (`dZoom, dTransX`) para encontrar a posi√ß√£o da imagem *visual*.
    3. Mapeia a interse√ß√£o da `targetBox` com esse ret√¢ngulo visual de volta para coordenadas do Video Source (`videoWidth`).
  - Resultado: Crop com precis√£o pixel-perfect independente do n√≠vel de zoom ou pan.

### [2025-12-29 01:50:00] - Fix: WYSIWYG Capture (Sniper Mode V2)
- **Problema**: C√°lculos matem√°ticos de proje√ß√£o falhavam em casos complexos de zoom interativo. Usu√°rio via uma coisa e o crop pegava outra.
- **Solu√ß√£o Definitiva**: Abordagem "Simula√ß√£o de Tela" (WYSIWYG).
  - Em vez de buscar coordenadas no video source, o sistema agora:
    1. Cria um Canvas tempor√°rio do tamanho exato da janela de visualiza√ß√£o (Viewport).
    2. Desenha o frame do v√≠deo replicando as transforma√ß√µes CSS atuais (Scale, Translate) via Context Matrix.
    3. Recorta pixel-a-pixel a √°rea onde a caixa de mira (Target Box) est√° sobreposta nesse canvas renderizado.
  - Isso garante que "O que voc√™ v√™ dentro do quadrado √© exatamente o que ser√° capturado", independente da resolu√ß√£o ou distor√ß√£o original.

### [2025-12-29 02:00:00] - Fix: Corre√ß√£o de Letterbox em Captura (Sniper V3)
- **Problema**: O `object-fit: contain` cria barras pretas (letterbox/pillarbox) dentro do elemento v√≠deo. O mapeamento anterior assumia que a imagem preenchia todo o elemento, causando erro de proje√ß√£o (offset) quando as barras existiam.
- **Solu√ß√£o (True Content Logic)**:
  - O sistema agora calcula o ret√¢ngulo exato onde o CONTE√öDO da imagem est√° renderizado dentro do elemento v√≠deo.
  - Compara a Aspect Ratio do v√≠deo vs Elemento para determinar se h√° barras verticais ou horizontais.
  - Usa esse "True Content Rect" como base para calcular a interse√ß√£o com a Target Box.
  - Resultado: Captura precisa mesmo em v√≠deos com aspect ratios diferentes da tela.

### [2025-12-29 02:10:00] - Fix: Inverse Transform Logic (Sniper V4)
- **Problema**: Abordagens anteriores V2/V3 falharam ao usar `video.getBoundingClientRect` (que infla com o zoom) ou tentar replicar renderiza√ß√£o. A captura continuava desalinhada devido a erro de referencial e letterboxing.
- **Solu√ß√£o (Matem√°tica Pura)**:
  - Adotado o referencial est√°vel da Viewport.
  - O sistema calcula matematicamente as coordenadas:
    1. Calcula o tamanho da imagem "Base" (sem zoom) dentro da Viewport usando l√≥gica de Aspect Ratio (`contain`).
    2. Aplica a transforma√ß√£o inversa no ponto central da Target Box: `(Screen - Pan) / Zoom`.
    3. Mapeia a ROI resultante para a resolu√ß√£o nativa do v√≠deo.
  - Resultado: Elimina qualquer depend√™ncia de como o browser reporta o tamanho do elemento transformado, garantindo precis√£o matem√°tica absoluta.

### [2025-12-29 02:20:00] - Fix: Native Screen Capture (Sniper Ultimate V5)
- **Problema**: Complexidade de zoom, pan e letterboxing tornaram imposs√≠vel garantir alinhamento perfeito via script.
- **Solu√ß√£o (Print Screen Nativo)**: 
  - Implementado uso de `navigator.mediaDevices.getDisplayMedia`.
  - Fluxo:
    1. Usu√°rio clica capturar e seleciona a ABA ATUAL.
    2. O navegador gera um stream de v√≠deo exato do que est√° na tela (pixel-perfect).
    3. O script captura 1 frame (`ImageCapture.grabFrame()`).
    4. Mapeamos as coordenadas da targetBox (clientX/Y) para o frame capturado.
    5. Recorte final √© 100% fiel ao que o olho v√™.

### [2025-12-29 02:30:00] - Fix: Robust Screen Capture (Sniper V6)
- **Problema**: A API `ImageCapture.grabFrame` (V5) retornou bitmaps vazios ou corrompidos em algumas vers√µes do Chrome, resultando em √≠cone de imagem quebrada.
- **Solu√ß√£o (Stream-to-Video-to-Canvas)**:
  - Substitu√≠da a captura direta de bitmap por um pipeline robusto:
    1. O `DisplayMediaStream` √© injetado em um elemento `<video>` oculto (`srcObject`).
    2. O script aguarda eventos `loadedmetadata` e um breve buffer para garantir renderiza√ß√£o.
    3. O frame √© desenhado do elemento v√≠deo para o Canvas usando `ctx.drawImage`.
  - Tratamento de DPI: Implementada l√≥gica de escala din√¢mica caso a resolu√ß√£o capturada difira da resolu√ß√£o CSS da janela (comum em telas HiDPI).

### [2025-12-29 02:40:00] - Fix: DOM-Attached Capture (Sniper V6.1)
- **Problema**: O elemento de v√≠deo oculto (`display: none`) usado na V6 falhou em rasterizar frames em certos contextos (Chrome optimization), resultando em tela preta no canvas.
- **Solu√ß√£o (Force Rendering)**:
  - O elemento `<video>` agora √© anexado fisicamente ao DOM (`document.body.appendChild`).
  - Em vez de `display: none`, usa-se `position: fixed; top: -10000px; opacity: 0` para mant√™-lo vis√≠vel para o renderizador, mas invis√≠vel para o usu√°rio.
  - Adicionado buffer maior (500-800ms) ap√≥s o `play()` para garantir que o pipeline de v√≠deo tenha decodificado o primeiro frame chave.

### [2025-12-29 02:50:00] - Fix: Guided & Reliable Capture (Sniper V7)
- **Problema**: O mecanismo V6.1 ainda apresentava comportamentos err√°ticos em algumas condi√ß√µes de renderiza√ß√£o. Relatos de "imagem quebrada" ou desalinhamento se o usu√°rio selecionasse "Tela Inteira" em vez de "Aba".
- **Solu√ß√£o (Simplifica√ß√£o e Instru√ß√£o)**:
  - Adicionada instru√ß√£o expl√≠cita na UI: _"Selecione a aba 'NVR Timeline'..."_.
  - Refinado o pipeline de v√≠deo para usar `video.onloadeddata` e verifica√ß√£o de `video.readyState >= 2` em vez de timeouts fixos.
  - Ajustada a opacidade do v√≠deo tempor√°rio para `0.01` (em vez de 0) e removido `top: -10000px` (agora `top: 0` com `z-index: -9999`) para garantir prioridade m√°xima de renderiza√ß√£o sem ser vis√≠vel.
  - Uso expl√≠cito de `preferCurrentTab: true` no stream.

### [2025-12-29 03:00:00] - Diag: Visual Debug Mode (Sniper V8)
- **Problema**: Persist√™ncia de tela preta ou imagem inv√°lida no V7, possivelmente devido a bloqueios de driver gr√°fico, permiss√µes ou falha de renderiza√ß√£o offscreen.
- **Solu√ß√£o (Modo Diagn√≥stico)**:
  - O elemento de v√≠deo de captura agora √© **VIS√çVEL** (`z-index: 99999`, `position: fixed`, `bottom: 10px`, `border: red`) por 4 segundos.
  - O objetivo √© permitir que o usu√°rio verifique visualmente se o stream est√° chegando (se ele ver um "espelho" da tela no canto, o stream funciona).
  - Adicionado `alert()` com as dimens√µes exatas do Stream vs Janela vs Crop para validar a matem√°tica do recorte.

### [2025-12-29 03:10:00] - Fix: Restore Self-Capture (Sniper V8.1)
- **Problema**: O usu√°rio reportou que a op√ß√£o "Esta Guia" sumiu da lista de compartilhamento no Chrome.
- **Causa**: Na refatora√ß√£o V8, a propriedade `selfBrowserSurface: 'include'` foi omitida acidentalmente. O comportamento padr√£o do Chrome mudou recentemente para `exclude` para evitar efeitos de "Hall of Mirrors".
- **Solu√ß√£o**:
  - Reintroduzido `selfBrowserSurface: 'include'` explicitamente nas constraints do `getDisplayMedia`.
  - Adicionados `surfaceSwitching: 'include'` e `monitorTypeSurfaces: 'include'` para garantir compatibilidade m√°xima.

### [2025-12-29 08:30:00] - Implementa√ß√£o Definitiva Solu√ß√£o Sniper V13
- **Problema**: Tentativas anteriores usando captura de tela (`getDisplayMedia`) ou c√°lculos simples falhavam devido √† complexidade de Zoom CSS + Letterboxing + Crop de C√¢mera (e.g. "Metade de Baixo").
- **Solu√ß√£o (Pure Math + Crop Correction)**:
  - Implementada fun√ß√£o `captureSniperTargetV13` que calcula coordenadas sem necessidade de streaming (permiss√µes zero).
  - **L√≥gica de Core**:
    1. **Un-Zoom**: Remove o fator de escala do `transform: scale()` das coordenadas do elemento DOM.
    2. **Mapeamento Split/Crop**: L√™ a vari√°vel global `CROP` (0-5) para entender se estamos exibindo apenas uma fatia do v√≠deo.
    3. **Ajuste de Refer√™ncia**:
       - Se CROP = 2 (Metade de Baixo), o "Topo" vis√≠vel √© na verdade `VideoHeight / 2`.
       - Adiciona `sourceOffsetY` √† coordenada Y calculada.
       - Recalcula a escala vertical considerando que a altura renderizada corresponde a apenas uma fra√ß√£o da altura do arquivo original.
    4. **Canvas Draw**: Usa `ctx.drawImage` para puxar os pixels diretamente do elemento `<video>` original, usando as coordenadas absolutas calculadas.
- **Resultado**: Captura 100% precisa (pixel-perfect) e instant√¢nea, independente de n√≠vel de zoom ou modo de visualiza√ß√£o (Full, Top, Bot, etc).
- **Legado**: Esta l√≥gica deve ser reutilizada sempre que precisarmos mapear cliques em elementos com `object-fit: contain` e/ou transforma√ß√µes CSS de volta para coordenadas de m√≠dia original.

### [2026-01-03 10:45:00] - Fix: Sanitiza√ß√£o de URL no Modo Totem
- **Problema**: Usu√°rio reportou "acesso local modo token" gerando URL com barra dupla (`//dashboard`). Identificado como erro de input no `totem.html` quando usu√°rio digita IP com barra final.
- **Solu√ß√£o**: Implementada limpeza de string (regex) no Input de IP para remover `http://`, `https://` e `/` trailing antes de construir a URL de redirecionamento.
- **Arquivo Alterado**: `www/totem.html`.

### [2026-01-06 09:00:00] - UX/UI: Ajustes Modo Totem e Rebranding
- **O que foi feito**:
  - `www/totem.html`: Input de IP agora vem preenchido por padr√£o com `192.168.3.65:5000` (solicita√ß√£o do usu√°rio). L√≥gica de redirecionamento aprimorada para detectar se o usu√°rio j√° digitou a porta e evitar duplica√ß√£o (ex: `:5000:5000`).
  - `www/dashboard.html`: T√≠tulo do aplicativo (Header e Title Tag) alterado de "OS BERBERTS" para "CAMERAS".
- **Motivo**: Melhorar a usabilidade do modo quiosque e simplificar a identidade visual do app.
- **Nota T√©cnica**: A tentativa de liberar a porta 5000 via `netsh` falhou por falta de privil√©gios admin. Se o acesso remoto falhar, o usu√°rio precisar√° liberar manualmente.

### [2026-01-06 09:10:00] - Documenta√ß√£o: Integra√ß√£o Home Assistant
- **O que foi feito**: Criado arquivo `COMO_INTEGRAR_HOME_ASSISTANT.md` na raiz com tutorial passo-a-passo.
- **Conte√∫do**: Instru√ß√µes para adicionar c√¢meras via Integra√ß√£o Gen√©rica (RTSP) ou Plugin HACS WebRTC, e como expor para o Google Home.
- **Motivo**: Solicita√ß√£o do usu√°rio sobre como habilitar o sistema no HA.

### [2026-01-06 09:25:00] - Infra: Script de Libera√ß√£o de Firewall
- **Problema**: Acesso via IP (`192.168.3.65:5000`) bloqueado pelo Windows Firewall em outros dispositivos. A tentativa autom√°tica falhou por falta de permiss√£o.
- **Solu√ß√£o**: Criado `LIBERAR_FIREWALL_ADMIN.bat`.
- **A√ß√£o Requerida**: Usu√°rio deve executar este script manualmente como Administrador para abrir as portas 5000 (Web), 8554 (RTSP) e 1984 (API).

### [2026-01-06 09:35:00] - Infra: Detec√ß√£o de Mudan√ßa de IP (DHCP)
- **Problema**: Usu√°rio relatou timeout ao acessar `192.168.3.65`.
- **Diagn√≥stico**: `ipconfig` revelou que o IP do servidor mudou para `192.168.3.130`.
- **Corre√ß√£o**: Atualizados `totem.html` e `COMO_INTEGRAR_HOME_ASSISTANT.md` com o novo IP para evitar confus√£o.
- **Recomenda√ß√£o**: Sugerido ao usu√°rio fixar IP est√°tico no adaptador de rede.

### [2026-01-21 09:35:00] - Reinicializa√ß√£o do Agente e Auditoria Arquitetural
- **O que foi feito**: 
  - Reinicializa√ß√£o do contexto do Agente com persona "Senior Software Architect".
  - Auditoria da estrutura de diret√≥rios atual versus a solicitada no Prompt de Inicializa√ß√£o.
- **Discrep√¢ncia Cr√≠tica Identificada**:
  - **Solicitado**: Estrutura segregada `/staging` e `/prd`.
  - **Encontrado**: Estrutura plana (Arquivos de produ√ß√£o na raiz `monitor/`) e sandbox legado (`test_lab_hd`).
- **A√ß√£o**: 
  - Registrado o estado atual.
  - Solicita√ß√£o de diretriz ao usu√°rio para migra√ß√£o segura (Risco de quebra de caminhos absolutos em scripts `.bat` e configura√ß√µes `go2rtc.yaml`).
